<h3>Crud de Libros</h3>
<!--Form reactivos-->
<form [formGroup]="form" class="ocultar" (submit)="onSubmit()">

  <mat-form-field class="formElement">
    <mat-label> Titulo:</mat-label>
    <input matInput type="text" placeholder="titulo" formControlName="titulo"/>
  
    <mat-error>
      @if (form.get('titulo')?.invalid && (form.get('titulo')?.dirty) || form.get('titulo')?.touched) {
        @if (form.get('titulo')?.errors?.['requiered']) {
          Titulo es requerido
        }
         @else if (form.get('titulo')?.errors?.['pattern']) {
          Titulo solo debe contener letras y numeros
        }
      }
    </mat-error>

  </mat-form-field>

  <mat-form-field class="formElement">
    <mat-label> Autor:</mat-label>
    <input matInput type="text" placeholder="autor" formControlName="autor"/>
    <mat-error>
      @if (form.get('autor')?.invalid && (form.get('autor')?.dirty) || form.get('autor')?.touched) {
        @if (form.get('autor')?.errors?.['requiered']) {
          autor es requerido
        }
      }
    </mat-error>
  </mat-form-field>

  <mat-form-field class="formElement">
    <mat-label>Área</mat-label>
    <mat-select
      [(value)]="selectedArea"
      (selectionChange)="onAreaChange($event.value)"
      formControlName="area">
      <mat-option *ngFor="let area of areas" [value]="area">{{ area }}</mat-option>
    </mat-select>
    <mat-error>
      <!-- Validación de errores -->
      <ng-container *ngIf="form.get('area')?.invalid && (form.get('area')?.dirty || form.get('area')?.touched)">
        <span *ngIf="form.get('area')?.errors?.['required']">Área es requerida</span>
      </ng-container>
    </mat-error>
  </mat-form-field>
  
  <!-- Selección de Categoría -->
  <mat-form-field class="formElement">
    <mat-label>Categoría</mat-label>
    <mat-select
      [(value)]="selectedCategoria"
      formControlName="categoria"
      [disabled]="!selectedArea">
      <mat-option *ngFor="let categoria of categorias" [value]="categoria">{{ categoria }}</mat-option>
    </mat-select>
    <mat-error>
      <!-- Validación de errores -->
      <ng-container *ngIf="form.get('categoria')?.invalid && (form.get('categoria')?.dirty || form.get('categoria')?.touched)">
        <span *ngIf="form.get('categoria')?.errors?.['required']">Categoría es requerida</span>
      </ng-container>
    </mat-error>
  </mat-form-field>

  <mat-form-field class="formElement">
    <mat-label> Estado:</mat-label>
    <mat-select formControlName="estado">
      <mat-option value="">Seleccione...</mat-option>
      <mat-option value="Nuevo">Nuevo</mat-option>
      <mat-option value="Usado - Excelente">Usado - Excelente</mat-option>
      <mat-option value="Usado - Bueno">Usado - Bueno</mat-option>
      <mat-option value="Usado - Aceptable">Usado - Aceptable</mat-option>
    </mat-select>
    <mat-error>
      @if (form.get('estado')?.invalid && (form.get('estado')?.dirty) || form.get('estado')?.touched) {
        @if (form.get('estado')?.errors?.['requiered']) {
          Estado es requerido
        }
      }
    </mat-error>
  </mat-form-field>

  <mat-form-field class="formElement">
    <mat-label>Descripcion: </mat-label>
    <textarea matInput formControlName="descripcion"></textarea>
    <mat-error>
      @if (form.get('descripcion')?.invalid && (form.get('descripcion')?.dirty) || form.get('descripcion')?.touched) {
        @if (form.get('descripcion')?.errors?.['requiered']) {
          Descripcion es requerido
        }
      }
    </mat-error>
  </mat-form-field>

  <mat-form-field class="formElement">
    <mat-label> Idioma:</mat-label>
    <mat-select formControlName="idioma">
      <mat-option value="">Seleccione...</mat-option>
      <mat-option value="Español">Español</mat-option>
      <mat-option value="Ingles">Ingles</mat-option>
      <mat-option value="Chino">Chino</mat-option>
      <mat-option value="Ruso">Ruso</mat-option>
      <mat-option value="Ruso">Frances</mat-option>
      <mat-option value="Ruso">Arabe</mat-option>
    </mat-select>
    <mat-error>
      @if (form.get('idioma')?.invalid && (form.get('idioma')?.dirty) || form.get('idioma')?.touched) {
        @if (form.get('idioma')?.errors?.['requiered']) {
          Idioma es requerido
        }
      }
    </mat-error>
  </mat-form-field>

  <mat-form-field class="formElement">
    <mat-label>Ubicacion: </mat-label>
    <textarea matInput formControlName="ubicacion"></textarea>
    <mat-error>
      @if (form.get('ubicacion')?.invalid && (form.get('ubicacion')?.dirty) || form.get('ubicacion')?.touched) {
        @if (form.get('ubicacion')?.errors?.['requiered']) {
          Ubicacion es requerido
        }
      }
    </mat-error>
  </mat-form-field>

  <mat-form-field class="formElement">
    <mat-label> URL de la portada:</mat-label>
    <input matInput type="url" placeholder="url" formControlName="imagen"/>
  </mat-form-field>

  <mat-checkbox class="formElement" formControlName="disponibilidad">Esta disponible?</mat-checkbox>

  <div class="actions">
    <button mat-raised-button color ="primary" type="submit">Guardar</button>    
    <button mat-raised-button color ="primary" type="reset" (click)="clearForm()">Cancelar</button>  
  </div>

</form>

<br>

<!--Busqueda-->
<div class="search-container">

    <mat-form-field>
        <mat-label> Buscar:</mat-label>
        <input matInput type="search" placeholder="area o categoria" #searchInput (keyup)="search(searchInput)"/>
    </mat-form-field>

    <button mat-raised-button color ="accent" (click)= "search(searchInput)">Buscar</button>
    
</div>
<table mat-table [dataSource]="dataSource" class="mat-elevation-z8">

     <!-- Name Column -->
  <ng-container matColumnDef="titulo">
    <th mat-header-cell *matHeaderCellDef> Titulo </th>
    <td mat-cell *matCellDef="let libro"> {{libro.titulo}} </td>
  </ng-container>

  <ng-container matColumnDef="autor">
    <th mat-header-cell *matHeaderCellDef> Autor </th>
    <td mat-cell *matCellDef="let libro"> {{libro.autor}} </td>
  </ng-container>

  <ng-container matColumnDef="area">
    <th mat-header-cell *matHeaderCellDef> Area </th>
    <td mat-cell *matCellDef="let libro"> {{libro.area}} </td>
  </ng-container>

  <ng-container matColumnDef="categoria">
    <th mat-header-cell *matHeaderCellDef> Categoria </th>
    <td mat-cell *matCellDef="let libro"> {{libro.categoria}} </td>
  </ng-container>

  <ng-container matColumnDef="estado">
    <th mat-header-cell *matHeaderCellDef> Estado </th>
    <td mat-cell *matCellDef="let libro"> {{libro.estado}} </td>
  </ng-container>

  <ng-container matColumnDef="idioma">
    <th mat-header-cell *matHeaderCellDef> Idioma </th>
    <td mat-cell *matCellDef="let libro"> {{libro.idioma}} </td>
  </ng-container>

  <ng-container matColumnDef="ubicacion">
    <th mat-header-cell *matHeaderCellDef> Ubicacion </th>
    <td mat-cell *matCellDef="let libro"> {{libro.ubicacion}} </td>
  </ng-container>

  <ng-container matColumnDef="disponibilidad">
    <th mat-header-cell *matHeaderCellDef> Disponible </th>
    <td mat-cell *matCellDef="let libro"> {{libro.disponibilidad? 'Yes': 'No'}} </td>
  </ng-container>

  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef> Acciones</th>
    <td mat-cell *matCellDef="let libro"> 
    <button mat-raised-button color ="accent" (click)="editar(libro)">Editar</button>    
    <button mat-raised-button color ="warn" (click)="eliminar(libro)">Eliminar</button>  
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="['titulo','autor','area','categoria','estado','idioma','ubicacion','disponibilidad','actions']"></tr>
  <tr mat-row *matRowDef="let row; columns: ['titulo','autor','area','categoria','estado','idioma','ubicacion','disponibilidad','actions'];"></tr>

</table>

<mat-paginator [pageSizeOptions]="[4, 7, 20]" aria-label="Select page" showFirstLastButtons>
</mat-paginator>